jQuery(document).ready(function(a){var b=Backbone.View.extend({id:0,project_id:thriveProjectSettings.project_id,page:1,priority:-1,current_page:1,max_page:1,min_page:1,total:0,show_completed:"no",total_pages:0}),b=new b,c=Backbone.View.extend({el:"body",model:b,search:"",template:"",events:{"click .thrive-project-tab-li-item-a":"switchView","click .next-page":"next","click .prev-page":"prev","click #thrive-task-search-submit":"searchTasks","change #thrive-task-filter-select":"filter"},switchView:function(b,c){if(a("#thrive-project-edit-tab").css("display","none"),a("#thrive-project-add-new").css("display","none"),a(".thrive-project-tab-li-item").removeClass("active"),a(".thrive-project-tab-content-item").removeClass("active"),b){var d=a(b.currentTarget),e=d.attr("data-content");d.parent().addClass("active"),a("div[data-content="+e+"]").addClass("active")}else{a(c).addClass("active");var e=a(c).attr("data-content");a("a[data-content="+e+"]").parent().addClass("active")}},hideFilters:function(){a("#thrive-tasks-filter").hide()},showFilters:function(){a("#thrive-tasks-filter").show()},searchTasks:function(){var b=a("#thrive-task-search-field").val();0==b.length?location.href="#tasks":location.href="#tasks/search/"+encodeURI(b)},filter:function(a){this.model.priority=a.currentTarget.value;var b=Backbone.history.getFragment();"tasks"!=b?location.href="#tasks":this.render()},next:function(a){a.preventDefault();var b=this.model.page;b<this.model.max_page&&(this.model.page=++b,location.href="#tasks/page/"+this.model.page)},prev:function(a){a.preventDefault();var b=this.model.page;b>this.model.min_page&&(this.model.page=--b,location.href="#tasks/page/"+this.model.page)},single:function(b){this.progress(!0);var c=this;this.template="thrive_ticket_single",this.renderTask(function(b){c.progress(!1);var b=JSON.parse(b);b.html&&a("#thrive-project-tasks").html(b.html)})},showEditForm:function(b){this.progress(!0);var c=this;a(".thrive-project-tab-content-item").removeClass("active"),a(".thrive-project-tab-li-item").removeClass("active"),a("a#thrive-project-edit-tab").css("display","block").parent().addClass("active"),a("#thrive-project-edit-context").addClass("active"),a("#thriveTaskId").attr("disabled",!0).val("loading..."),a("#thriveTaskEditTitle").attr("disabled",!0).val("loading..."),a("#thrive-task-edit-select-id").attr("disabled",!0),this.model.id=b,this.renderTask(function(b){c.progress(!1);var b=JSON.parse(b);if(b.task){var d=b.task;a("#thriveTaskId").val(d.id).removeAttr("disabled"),a("#thriveTaskEditTitle").val(d.title).removeAttr("disabled"),tinymce.editors.thriveTaskEditDescription.setContent(d.description),a("#thrive-task-edit-select-id").val(d.priority).change().removeAttr("disabled")}})},renderTask:function(b){a.ajax({url:ajaxurl,method:"get",data:{action:"thrive_transactions_request",method:"thrive_transaction_fetch_task",id:this.model.id,template:this.template,nonce:thriveProjectSettings.nonce},success:function(a){b(a)}})},render:function(){var c=this;this.progress(!0),a.ajax({url:ajaxurl,method:"get",data:{action:"thrive_transactions_request",method:"thrive_transaction_fetch_task",id:this.model.id,project_id:this.model.project_id,page:this.model.page,search:this.search,priority:this.model.priority,template:"thrive_the_tasks",show_completed:this.model.show_completed,nonce:thriveProjectSettings.nonce},success:function(d){c.progress(!1);var d=JSON.parse(d);"success"==d.message&&(d.task.stats&&(b.max_page=d.task.stats.max_page,b.min_page=d.task.stats.min_page),a("#thrive-project-tasks").html(d.html)),0===d.task.length&&a("#thrive-project-tasks").html('<div class="error" id="message"><p>No tasks found. If you\'re trying to find a task, kindly try different keywords and/or filters.</p></div>')},error:function(){}})},initialize:function(){},progress:function(b){if(b)var c="block",d=.25;else var c="none",d=1;a("#thrive-preloader").css({display:c}),a("#thrive-project-tasks").css({opacity:d})},updateStats:function(b){a(".thrive-total-tasks").text(b.total),a(".thrive-remaining-tasks-count").text(b.remaining),a(".task-progress-completed").text(b.completed),a(".task-progress-percentage-label > span").text(b.progress)}}),c=new c,d=Backbone.Router.extend({routes:{tasks:"index","tasks/dashboard":"dashboard","tasks/settings":"settings","tasks/completed":"completed_tasks","tasks/add":"add","tasks/edit/:id":"edit","tasks/page/:page":"next","tasks/view/:id":"view_task","tasks/search/:search_keyword":"search"},view:c,model:b,index:function(){this.view.switchView(null,"#thrive-project-tasks-context"),this.model.page=1,this.model.id=0,this.model.show_completed="no",this.view.search="",this.view.render()},dashboard:function(){this.view.switchView(null,"#thrive-project-dashboard-context")},settings:function(){this.view.switchView(null,"#thrive-project-settings-context")},add:function(){this.view.switchView(null,"#thrive-project-add-new-context"),a("#thrive-project-add-new").css("display","block")},completed_tasks:function(){this.view.switchView(null,"#thrive-project-tasks-context"),this.model.show_completed="yes",this.view.render()},edit:function(a){this.view.showEditForm(a)},next:function(a){this.model.page=a,this.view.render()},view_task:function(a){this.model.id=a,this.view.single(a),this.view.switchView(null,"#thrive-project-tasks-context")},search:function(a){this.model.page=1,this.model.id=0,this.view.search=a,this.view.render()}}),d=new d;d.on("route",function(a){"view_task"===a?this.view.hideFilters():this.view.showFilters()}),Backbone.history.start(),a("#thrive-submit-btn").click(function(b){b.preventDefault();var d=a(this);d.attr("disabled",!0),d.text("Loading ..."),a.ajax({url:ajaxurl,data:{action:"thrive_transactions_request",method:"thrive_transaction_add_ticket",title:a("#thriveTaskTitle").val(),description:tinymce.editors.thriveTaskDescription.getContent(),milestone_id:a("#thriveTaskMilestone").val(),project_id:thriveTaskConfig.currentProjectId,user_id:thriveTaskConfig.currentUserId,priority:a("#thrive-task-priority-select").val(),nonce:thriveProjectSettings.nonce},method:"post",success:function(b){parseInt(a(".thrive-total-tasks").text().trim()),parseInt(a(".thrive-remaining-tasks-count").text().trim());b=JSON.parse(b),"success"===b.message?(d.text("Save Task"),d.removeAttr("disabled"),a("#thriveTaskDescription").val(""),a("#thriveTaskTitle").val(""),c.updateStats(b.stats),location.href="#tasks/view/"+b.response.id):(a("#thrive-add-task-message").text(b.response).show().addClass("error"),setTimeout(function(){a("#thrive-add-task-message").text("").hide().removeClass("error")},3e3),d.text("Save Task"),d.removeAttr("disabled"))},error:function(){}})}),a("#thrive-edit-btn").click(function(b){b.preventDefault();var c=a(this);c.attr("disabled",!0),c.text("Loading ..."),a.ajax({url:ajaxurl,data:{action:"thrive_transactions_request",method:"thrive_transaction_edit_ticket",title:a("#thriveTaskEditTitle").val(),description:tinymce.editors.thriveTaskEditDescription.getContent(),milestone_id:a("#thriveTaskMilestone").val(),id:a("#thriveTaskId").val(),project_id:thriveTaskConfig.currentProjectId,user_id:thriveTaskConfig.currentUserId,priority:a("#thrive-task-edit-select-id").val(),nonce:thriveProjectSettings.nonce},method:"post",success:function(b){var d=JSON.parse(b),b="<p>Task successfully updated <a href='#tasks/view/"+d.id+"'>&#65515; View</a></p>";"fail"===d.message&&"no_changes"!==d.type&&(b="<p>There was an error updating the task. All fields are required.</a></p>"),a("#thrive-edit-task-message").html(b).show(),c.attr("disabled",!1),c.text("Update Task")},error:function(){console.log("An Error Occured [thrive.js]#311")}})}),a("body").on("click","#thrive-delete-btn",function(){var d=confirm("Are you sure you want to delete this task? This action is irreversible");if(d){var e=a(this),f=parseInt(b.id),g=parseInt(b.project_id),h={action:"thrive_transactions_request",method:"thrive_transaction_delete_ticket",id:f,project_id:g,nonce:thriveProjectSettings.nonce};c.progress(!0),e.text("Deleting ..."),a.ajax({url:ajaxurl,data:h,method:"post",success:function(a){var a=JSON.parse(a);c.progress(!1),c.updateStats(a.stats),location.href="#tasks",c.switchView(null,"#thrive-project-tasks-context"),e.text("Delete")},error:function(){c.progress(!1),location.href="#tasks",c.switchView(null,"#thrive-project-tasks-context"),e.text("Delete")}})}}),a("body").on("click","#updateTaskBtn",function(){var d=b.id,e=a("#task-comment-content").val(),f=a("#thrive-task-priority-update-select").val(),g=a("input[name=task_commment_completed]:checked").val(),h=parseInt(b.project_id);if(0!==d&&0!==e.length){c.progress(!0);var i={action:"thrive_transactions_request",method:"thrive_transaction_add_comment_to_ticket",ticket_id:d,priority:f,details:e,completed:g,project_id:h,nonce:thriveProjectSettings.nonce};a.ajax({url:ajaxurl,data:i,method:"post",success:function(b){var b=JSON.parse(b);c.progress(!1),a("#task-comment-content").val(""),a("#task-lists").append(b.result),"yes"===g&&(a("#ticketStatusInProgress").attr("disabled",!0).attr("checked",!1),a("#ticketStatusComplete").attr("disabled",!0).attr("checked",!1),a("#comment-completed-radio").addClass("hide"),a("#ticketStatusCompleteUpdate").attr("disabled",!1).attr("checked",!0),a("#ticketStatusReOpenUpdate").attr("disabled",!1),a("#thrive-comment-completed-radio").removeClass("hide")),"reopen"===g&&(a("#ticketStatusInProgress").attr("disabled",!1).attr("checked",!0),a("#ticketStatusComplete").attr("disabled",!1).attr("checked",!1),a("#comment-completed-radio").removeClass("hide"),a("#ticketStatusCompleteUpdate").attr("disabled",!0).attr("checked",!1),a("#ticketStatusReOpenUpdate").attr("disabled",!0),a("#thrive-comment-completed-radio").addClass("hide")),c.updateStats(b.stats)},error:function(){c.progress(!1)}})}}),a("body").on("click","a.thrive-delete-comment",function(b){b.preventDefault();var d=confirm("Are you sure you want to delete this comment? This action is irreversible. ");if(!d)return!1;var e=a(this),f=parseInt(a(this).attr("data-comment-id")),g={action:"thrive_transactions_request",method:"thrive_transaction_delete_comment",comment_id:f,nonce:thriveProjectSettings.nonce};c.progress(!0),a.ajax({url:ajaxurl,data:g,method:"post",success:function(b){c.progress(!1);var b=JSON.parse(b);"success"==b.message?e.parent().parent().parent().parent().fadeOut(function(){a(this).remove()}):this.error()},error:function(){c.progress(!1),e.parent().append('<p class="error">Transaction Error: There was an error trying to delete this comment.</p>')}})}),a("body").on("click","#thriveUpdateProjectBtn",function(){var b=a(this),d={action:"thrive_transactions_request",method:"thrive_transactions_update_project",id:parseInt(a("#thrive-project-id").val()),title:a("#thrive-project-name").val(),content:tinymce.editors.thriveProjectContent.getContent(),group_id:parseInt(a("#thrive-project-assigned-group").val()),nonce:thriveProjectSettings.nonce};b.attr("disabled",!0).text("Updating ..."),c.progress(!0),a(".thrive-project-updated").remove(),a.ajax({url:ajaxurl,data:d,method:"post",success:function(d){var d=JSON.parse(d);c.progress(!1),b.attr("disabled",!1).text("Update Project"),"success"===d.message?(a("article .entry-header > .entry-title").text(a("#thrive-project-name").val()),b.parent().parent().prepend('<div id="message" class="thrive-project-updated success updated"><p>Project details successfully updated.</p></div>')):b.parent().parent().prepend('<div id="message" class="thrive-project-updated success updated"><p>There was an error saving the project. All fields are required.</p></div>'),c.progress(!1),setTimeout(function(){a(".thrive-project-updated").fadeOut()},3e3)},error:function(){alert("connection failure")}})}),a("body").on("click","#thriveDeleteProjectBtn",function(){if(confirm("Are you sure you want to delete this project? All the tickets under this project will be deleted as well. This action cannot be undone.")){var b=a("#thrive-project-id").val(),c={action:"thrive_transactions_request",method:"thrive_transactions_delete_project",id:b,nonce:thriveProjectSettings.nonce};a(this).text("Deleting..."),a.ajax({url:ajaxurl,method:"post",data:c,success:function(a){var a=JSON.parse(a);"success"==a.message?window.location=a.redirect:(console.log("__success_callback"),this.error())},error:function(){alert("There was an error trying to delete this post. Try again later.")}})}})});
//# sourceMappingURL=thrive.min.js.map